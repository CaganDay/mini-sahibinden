<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Complex SQL Queries - Mini Sahibinden</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .query-card { transition: transform 0.2s; }
        .query-card:hover { transform: translateY(-3px); }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-warning pb-3 pt-3" style="background-color: #f8f9fa!important; border-bottom: 1px solid #ddd;">
    <div class="container">
        <a class="navbar-brand fw-bold text-dark" th:href="@{/}">mini<span class="bg-warning px-1 rounded border border-dark">sahibinden</span>.com</a>
        <div class="navbar-nav ms-auto">
            <a class="btn btn-outline-dark btn-sm" th:href="@{/}">
                <i class="fa-solid fa-home"></i> Home
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="mb-3"><i class="fa-solid fa-database text-primary"></i> Complex SQL Queries</h2>
            <p class="text-muted">Explore advanced SQL queries with different filtering and aggregation capabilities.</p>
        </div>
    </div>

    <div class="row g-4">
        <!-- Query 1: Active Users -->
        <div class="col-md-6">
            <div class="card shadow-sm query-card h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fa-solid fa-users"></i> Query 1: Active Users</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Find listings from users who have posted multiple listings (uses subquery with GROUP BY and HAVING).</p>
                    <form th:action="@{/queries/active-users}" method="get">
                        <div class="mb-3">
                            <label for="minListingCount1" class="form-label">Minimum Listings Count</label>
                            <input type="number" class="form-control" id="minListingCount1" 
                                   name="minListingCount" value="2" min="1" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fa-solid fa-search"></i> Execute Query
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Query 2: Above Average -->
        <div class="col-md-6">
            <div class="card shadow-sm query-card h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fa-solid fa-chart-line"></i> Query 2: Above Average</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Find listings priced above their category's average (uses correlated subquery).</p>
                    <form th:action="@{/queries/above-average}" method="get">
                        <p class="text-info"><i class="fa-solid fa-info-circle"></i> No parameters needed</p>
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fa-solid fa-search"></i> Execute Query
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Query 3: Price and User Filter -->
        <div class="col-md-6">
            <div class="card shadow-sm query-card h-100">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="fa-solid fa-filter"></i> Query 3: Price & User Filter</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Filter by price range, user name pattern, and recent days (uses JOIN with multiple WHERE conditions).</p>
                    <form th:action="@{/queries/price-user-filter}" method="get">
                        <div class="mb-2">
                            <label for="minPrice3" class="form-label">Min Price</label>
                            <input type="number" class="form-control form-control-sm" id="minPrice3" 
                                   name="minPrice" value="0" min="0" step="0.01">
                        </div>
                        <div class="mb-2">
                            <label for="maxPrice3" class="form-label">Max Price</label>
                            <input type="number" class="form-control form-control-sm" id="maxPrice3" 
                                   name="maxPrice" value="1000000" min="0" step="0.01">
                        </div>
                        <div class="mb-2">
                            <label for="userName3" class="form-label">User Name Pattern</label>
                            <input type="text" class="form-control form-control-sm" id="userName3" 
                                   name="userNamePattern" placeholder="e.g., John">
                        </div>
                        <div class="mb-3">
                            <label for="daysBack3" class="form-label">Days Back</label>
                            <input type="number" class="form-control form-control-sm" id="daysBack3" 
                                   name="daysBack" value="30" min="1">
                        </div>
                        <button type="submit" class="btn btn-warning w-100">
                            <i class="fa-solid fa-search"></i> Execute Query
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Query 4: Top Per Category -->
        <div class="col-md-6">
            <div class="card shadow-sm query-card h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fa-solid fa-trophy"></i> Query 4: Top Per Category</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Get top N listings per category ranked by price (uses window function ROW_NUMBER).</p>
                    <form th:action="@{/queries/top-per-category}" method="get">
                        <div class="mb-3">
                            <label for="topN4" class="form-label">Top N Listings</label>
                            <input type="number" class="form-control" id="topN4" 
                                   name="topN" value="3" min="1" max="10" required>
                        </div>
                        <button type="submit" class="btn btn-info w-100 text-white">
                            <i class="fa-solid fa-search"></i> Execute Query
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Query 5: Complex Filter -->
        <div class="col-md-12">
            <div class="card shadow-sm query-card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0"><i class="fa-solid fa-sliders"></i> Query 5: Complex Multi-Condition Filter</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Advanced filtering with category, price range, date range, keyword search, and sorting (uses multiple JOINs, NOT IN subquery, and dynamic sorting).</p>
                    <form th:action="@{/queries/complex-filter}" method="get">
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <label for="category5" class="form-label">Category</label>
                                <select class="form-select form-select-sm" id="category5" name="categoryId">
                                    <option value="">All Categories</option>
                                    <option th:each="cat : ${categories}" 
                                            th:value="${cat.id}" 
                                            th:text="${cat.name}">Category</option>
                                </select>
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="minPrice5" class="form-label">Min Price</label>
                                <input type="number" class="form-control form-control-sm" id="minPrice5" 
                                       name="minPrice" value="0" min="0" step="0.01">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="maxPrice5" class="form-label">Max Price</label>
                                <input type="number" class="form-control form-control-sm" id="maxPrice5" 
                                       name="maxPrice" value="1000000" min="0" step="0.01">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="startDate5" class="form-label">Start Date</label>
                                <input type="date" class="form-control form-control-sm" id="startDate5" 
                                       name="startDate">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="endDate5" class="form-label">End Date</label>
                                <input type="date" class="form-control form-control-sm" id="endDate5" 
                                       name="endDate">
                            </div>
                            <script>
                                // Set default dates
                                document.addEventListener('DOMContentLoaded', function() {
                                    const today = new Date();
                                    const oneYearAgo = new Date();
                                    oneYearAgo.setFullYear(today.getFullYear() - 1);
                                    
                                    document.getElementById('startDate5').value = oneYearAgo.toISOString().split('T')[0];
                                    document.getElementById('endDate5').value = today.toISOString().split('T')[0];
                                });
                            </script>
                            <div class="col-md-3 mb-2">
                                <label for="keyword5" class="form-label">Keyword</label>
                                <input type="text" class="form-control form-control-sm" id="keyword5" 
                                       name="keyword" placeholder="Search in title/description">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="sortBy5" class="form-label">Sort By</label>
                                <select class="form-select form-select-sm" id="sortBy5" name="sortBy">
                                    <option value="date">Date</option>
                                    <option value="price">Price</option>
                                    <option value="title">Title</option>
                                </select>
                            </div>
                            <div class="col-md-12 mt-2">
                                <button type="submit" class="btn btn-danger w-100">
                                    <i class="fa-solid fa-search"></i> Execute Complex Query
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="mt-5 py-3 text-center text-muted border-top">
    <small>&copy; 2025 Mini-Sahibinden Project</small>
</footer>

</body>
</html>

